#!/usr/bin/bash

# self-consistent calculation
cat > na128.scf.in << EOF
&CONTROL
   calculation      = 'scf'
   restart_mode     = 'from_scratch'
   tstress          = .true.
   tprnfor          = .true.
   disk_io          = 'medium'
   outdir           = './out'
   pseudo_dir       = './'
/
&SYSTEM
   ecutwfc          = 130
   occupations      = 'smearing'
   degauss          = 0.02
   smearing         = 'mp'
   ntyp             = 1
   nat              = 128
   ibrav            = 0
/
&ELECTRONS
   conv_thr         = 1e-08
   mixing_mode      = 'local-TF'
   mixing_beta      = 0.7
   electron_maxstep = 10
/
&IONS
/
&CELL
/

ATOMIC_SPECIES
Na 22.98976928 Na.pbe-spn-kjpaw_psl.1.0.0.UPF

K_POINTS automatic
3 3 3  0 0 0

CELL_PARAMETERS angstrom
17.96731588454088 0.00000000000000 0.00000000000000
0.41240380149787 17.42851201579527 0.00000000000000
0.35415376340019 0.04346293712470 17.95615818137658

ATOMIC_POSITIONS angstrom
Na 10.2093145659 13.0998226794 8.7682567758 
Na 3.2832880126 7.8726238103 8.9245742207 
Na 1.4812884071 10.2425469134 11.7954781959 
Na 14.2823936796 13.4316628332 16.4761185027 
Na 15.0196393653 11.8248385868 13.3619460541 
Na 4.7869385411 5.4390892221 16.1485491799 
Na 11.9656502381 2.0612392260 8.4114294758 
Na 4.6782847917 10.3631561147 12.3855194593 
Na 1.9175743649 4.5170011807 0.5166483715 
Na 15.0730759595 6.2354563608 14.2036249667 
Na 2.5877300931 3.8611294686 6.5728178707 
Na 9.1826711199 9.8802180213 13.4155048261 
Na 2.1865702379 10.1430187638 4.0444158546 
Na 5.5084466549 15.1846817389 11.9781986115 
Na 8.2081598410 10.4756153416 5.7935789743 
Na 0.7601055018 6.7482830842 11.2340337124 
Na 12.5604133121 2.9347580191 5.9113080149 
Na 9.2102437629 10.4443468217 17.3595211163 
Na 7.9500575516 15.3735379929 6.6083554248 
Na 7.2593903355 1.3565413329 2.4949432805 
Na 11.3342518069 15.0412091281 16.6289844262 
Na 9.3103199156 6.0629000557 16.6642416902 
Na 18.0497535233 5.8757758510 7.9968372552 
Na 7.6442520385 8.3848647992 9.7142808754 
Na 5.4033432471 11.0303130979 8.4882163937 
Na 14.7331828547 3.0599434958 2.9818198096 
Na 1.2683577466 5.2594196567 14.9294021148 
Na 4.8013824663 5.2198304729 9.0681079204 
Na 2.3746934254 2.0715973836 16.4323195768 
Na 8.7722275526 10.5102635135 2.9502224879 
Na 15.1504234577 10.1318934018 15.6399304018 
Na 11.4134409549 17.2852765736 5.9096496316 
Na 13.7064316049 6.1730900106 17.6051055767 
Na 16.3437065716 1.6661792745 5.8659243717 
Na 10.1806063886 13.5747689108 4.6587597096 
Na 16.5707469653 5.0944886805 1.0986654317 
Na 14.5717770660 8.4536975864 3.0451384275 
Na 15.5326493554 6.8408327283 9.1089781738 
Na 13.7978097800 2.9709927050 14.9335507680 
Na 16.1654636111 14.2035566909 0.5548109505 
Na 14.1680802257 0.8556467040 17.2382525144 
Na 3.5698541238 5.0941958133 12.2583216432 
Na 7.6530973481 13.8464634747 2.7043918752 
Na 13.9210296323 13.0144240270 3.9385937543 
Na 18.1098991132 8.9656816427 8.6274684820 
Na 16.9319888348 1.1508766549 1.4636373160 
Na 16.5999061222 2.9490330515 16.7185317319 
Na 11.7580792279 10.1042956046 4.7623376922 
Na 2.3484144292 11.3165000988 6.9197847078 
Na 11.1441504179 0.7056429739 12.6886406554 
Na 1.1617325072 15.6514528415 16.6488706515 
Na 5.9427544111 0.3679544587 8.0313398919 
Na 16.2639173152 11.6709467295 9.5368554278 
Na 6.3791966846 13.8013241870 8.6509158292 
Na 9.9240295243 7.2114804877 11.6625595864 
Na 6.0062922303 10.3511269967 16.3787626016 
Na 9.3221783441 0.4202537218 9.2303437992 
Na 4.0075289551 14.9290912802 6.8286023764 
Na 10.9359577386 11.7282624671 15.1261891420 
Na 15.2030048076 10.9445586927 0.5669496691 
Na 1.4557155264 0.5368166836 3.4889383167 
Na 9.7423583999 1.0540867243 17.2633851959 
Na 16.3035675879 2.8100504730 8.9614557300 
Na 10.2746455232 8.9979994538 7.9112301819 
Na 4.0022339871 1.4578895717 1.1201992598 
Na 12.2158235510 8.7452406441 14.0622257842 
Na 8.7268672669 15.5154240897 14.0819898317 
Na 6.8511783088 2.6440809860 14.2454708454 
Na 17.3839997874 12.2310742087 5.6904771255 
Na 10.0515794998 3.6554486200 11.1866125756 
Na 10.6085465281 7.2083092565 1.6308717021 
Na 15.9215860456 9.1827699402 12.7769068914 
Na 12.3157164371 6.1031234858 8.4576072743 
Na 5.0170423621 3.8500274641 4.3131458114 
Na 4.0109211844 13.7577696165 14.5677937120 
Na 0.9229774235 7.3696288021 5.1108551086 
Na 2.9667344511 6.3338992845 3.0694769536 
Na 0.3219922680 0.4034057697 13.4386844603 
Na 11.0518577064 3.0108010901 1.6224360473 
Na 7.2367587044 1.7449282233 11.0672485092 
Na 11.8256920343 6.5022710016 4.5503377386 
Na 7.9984183790 3.7297470646 8.0171259483 
Na 16.6979932931 15.5547078291 4.3351413995 
Na 7.1535556580 7.2972708276 14.1005338984 
Na 5.7701729519 11.1729789763 4.6251230975 
Na 17.9184825167 -0.1153196235 9.8913505702 
Na 3.0923457532 16.3436814173 10.5603869346 
Na 2.5629998796 13.2785525542 3.8802898142 
Na 15.2425329026 4.8553185519 5.8430627590 
Na 11.3392664848 11.1738953094 11.5539543488 
Na 13.6426260727 13.3489467011 7.5670321083 
Na 4.7524969933 9.8657381614 1.7282581476 
Na 7.5753222278 13.5376807773 16.5278464051 
Na 4.6547637785 7.2055512735 5.8122577959 
Na 5.0664399037 17.0239527444 15.3260252227 
Na 6.4550205543 15.8091986880 0.6055290897 
Na 13.6542149914 1.2500472550 11.1326154011 
Na 18.3989177631 8.6831923155 15.4551006233 
Na 11.9022094424 5.2101928046 14.6109817492 
Na 12.4366185057 13.9173445358 12.4794723508 
Na 7.4737314304 6.8324635526 4.6285279038 
Na 14.4625878906 16.8174076679 8.0969511393 
Na 10.2534297166 15.9219274246 2.1514638994 
Na 11.8342193224 12.7899188216 1.5663223230 
Na 4.6704402616 12.8675969184 0.3984090592 
Na 13.7340042478 4.7730300418 10.7421550825 
Na 18.2952176027 11.4549957631 2.8400558905 
Na 15.1323681019 16.4898365484 14.6935757036 
Na 6.2956019507 6.2290276551 11.3978920398 
Na 2.3448766647 15.4053796701 1.9149044218 
Na 9.5269913714 15.4527145638 10.3886607196 
Na 7.2897317418 11.7636185513 11.1719602295 
Na 1.1778060680 7.8363765472 0.3177717455 
Na 2.3504519228 11.3621047400 17.7127100348 
Na 9.1687141090 6.3620432881 6.7549992669 
Na 9.1482924577 3.8041802641 4.9288551823 
Na 17.6161662564 14.8707747631 7.3911931746 
Na 2.8012788294 12.8125127213 10.6909877603 
Na 14.5411553695 8.6784094160 6.1110470721 
Na 6.5511924093 4.0820825357 1.4400839616 
Na 1.0764650162 0.5133837102 6.8516364754 
Na 5.2778415457 16.1332320431 3.6323606191 
Na 18.1455229104 14.7058312098 12.2024828189 
Na 2.3235997693 2.9293049387 9.6252689958
Na 18.2415384498 11.7278851535 14.9046359666 
Na 0.4313629132 4.0013068736 4.0420495591
Na 11.7029105844 9.8428495977 0.5964897331 
Na 13.8976056426 16.5637684598 2.8011009529 

EOF

export OMP_NUM_THREADS=1
spack load quantum-espresso@7.1    
echo "  running the scf calculation for 128 Na atoms...\c"
mpirun pw.x -nk 1 -in na128.scf.in > na128.scf.out
